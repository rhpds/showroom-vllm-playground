= Module 2: Structured outputs for system integration
:source-highlighter: rouge
:toc: macro
:toclevels: 1

In Module 1, ACME deployed a vLLM server and validated the chat interface. Now they face a critical integration challenge: their customer support system needs AI responses in specific formats that backend systems can reliably consume.

Free-form text responses from AI are difficult to parse programmatically and cause integration failures. ACME's engineering team requires predictable, structured outputs - whether simple category labels, full JSON objects, or specific ID formats.

This module demonstrates vLLM Playground's structured output capabilities: Choice mode, JSON Schema, Regex patterns, and Grammar rules. These features transform unpredictable AI text into reliable, system-ready data.

**Presenter note**: For 30-45 minute demos, focus on Part 1 (JSON Schema) as it delivers the most business value for system integration. Parts 2-3 are optional for 60 minute deep dives.

== Part 1 — JSON Schema for reliable API integration

=== Know

_ACME Corporation's biggest integration challenge: AI responses must conform to exact data structures expected by their CRM, ticketing, and analytics systems. Manual parsing of free-text AI outputs fails 20-30% of the time due to format variations._

**Business challenge**: AI integration reliability

* Free-form AI text is unpredictable - varying formats break downstream systems
* Manual post-processing of AI responses requires custom parsing code for each integration
* Format inconsistencies cause API rejections, requiring retry logic and error handling
* Support engineers waste time manually reformatting AI outputs for system entry

**Current state pain points**:

* **Integration failures**: 20-30% of AI responses rejected by backend systems due to format issues
* **Custom parsing overhead**: Development teams build and maintain fragile parsing logic for each system
* **Data quality issues**: Inconsistent field names, missing required data, type mismatches
* **Manual rework**: Support agents manually copy/paste and reformat AI responses into ticketing systems

**Desired state transformation**:

* AI outputs conform to exact JSON schemas required by backend APIs
* Zero parsing errors - responses are directly consumable by systems
* Required fields guaranteed present with correct types and values
* Enum constraints ensure only valid status codes, categories, and labels

**Business value proposition**:

vLLM Playground's JSON Schema support eliminates integration failures by constraining AI outputs to match exact API specifications. What currently fails 20-30% of the time becomes 100% reliable system integration.

**Quantified business impact**:

* **Zero integration failures**: 100% schema-compliant responses eliminate API rejections
* **Remove parsing overhead**: Eliminate hours of custom parsing code development per integration
* **Faster deployments**: New AI features deploy in days instead of weeks (no custom parsers needed)
* **Data quality improvement**: Required fields and type safety guarantee clean data

**Stakeholder impact**:

* **Engineering Leaders**: Reduce integration development time by 60-80% (no custom parsers)
* **Backend Teams**: Eliminate parsing errors and API retry logic
* **Support Operations**: Direct AI-to-system integration without manual reformatting
* **Data Quality Teams**: Guaranteed schema compliance ensures clean analytics

=== Show

**Presenter guidance**: Demonstrate how ACME transforms unreliable AI text into guaranteed-valid JSON that backend systems consume directly. Emphasize the elimination of parsing failures.

**What to demonstrate**:

. **Access vLLM Playground** (30 seconds):
+
link:http://{hostname}:7860[Open vLLM Playground^]
+
**Business context**: "We're picking up where Module 1 left off. The vLLM server is running, now we'll configure it for structured outputs."

. **Deploy a capable model for structured outputs** (2 minutes):
+
**If TinyLlama is still running** - stop it and deploy Qwen:
+
* Click *Stop Server* in the UI
* In Model section, select or enter: `Qwen/Qwen2.5-3B-Instruct`
* Ensure *Container* mode and *GPU* mode selected
* Click *Start Server*
* Wait for green "Server is ready to chat!" notification
+
**Business talking point**: "While TinyLlama worked for basic chat, structured outputs require stronger instruction-following capabilities. Qwen2.5-3B balances capability with speed - perfect for production support workloads."

. **Navigate to Structured Outputs panel** (15 seconds):
+
**Click the Structured Outputs icon in the toolbar**
+
**Business context**: "This is where ACME configures output constraints. The same AI that generated free text now conforms to exact schemas."
+
image::module-02-figure-01.png[Structured outputs configuration panel showing Enable checkbox and Output Type options,width=600,title="Structured Outputs Panel"]

. **Configure JSON Schema for customer support tickets** (3-4 minutes):
+
**Enable Structured Outputs** - check the checkbox
+
**Select JSON mode** from Output Type dropdown
+
**Define the schema** that ACME's ticketing system expects:
+
[source,json]
----
{
  "type": "object",
  "properties": {
    "ticket_type": {
      "type": "string",
      "enum": ["billing", "technical", "general", "complaint", "feature_request"]
    },
    "priority": {
      "type": "string",
      "enum": ["low", "medium", "high", "urgent"]
    },
    "summary": {
      "type": "string",
      "maxLength": 100
    },
    "customer_sentiment": {
      "type": "string",
      "enum": ["positive", "negative", "neutral"]
    },
    "requires_escalation": {
      "type": "boolean"
    }
  },
  "required": ["ticket_type", "priority", "summary", "customer_sentiment", "requires_escalation"]
}
----
+
image::module-02-figure-04.png[JSON Schema configuration in structured outputs panel,width=600,title="JSON Schema Mode"]
+
**Business talking point**: "This schema matches ACME's ticketing API exactly. Notice the enum constraints - the AI can ONLY output valid categories, priorities, and sentiments. Required fields guarantee the backend never receives incomplete data."

. **Set system prompt for ticket extraction** (1 minute):
+
**Configure system prompt**:
+
----
You are a customer support ticket classifier. Extract structured information from customer messages and output a JSON object with ticket_type, priority, summary, customer_sentiment, and requires_escalation fields.
----
+
**Business talking point**: "The system prompt explains what we want the AI to do. The JSON Schema enforces HOW it outputs the result."

. **Test with realistic customer scenario** (2-3 minutes):
+
**Send customer message**:
+
----
Customer message: "I've been charged twice for my subscription this month! This is unacceptable and I want a refund immediately. I've been a loyal customer for 3 years and this is how you treat me?"
----
+
**What they'll see** - JSON output:
+
[source,json]
----
{
  "ticket_type": "billing",
  "priority": "high",
  "summary": "Customer charged twice for subscription, requesting immediate refund",
  "customer_sentiment": "negative",
  "requires_escalation": true
}
----
+
image::module-02-figure-05.png[JSON Schema output showing structured ticket extraction,width=600,title="JSON Schema Structured Output"]
+
**Business value callout**: "Notice what just happened. The AI understood the customer's frustration, extracted the issue, correctly classified it as high-priority billing with negative sentiment, and flagged for escalation - all in perfectly formatted JSON that ACME's ticketing API can consume directly. No parsing code needed."

. **Test contrasting scenario** (2 minutes):
+
**Send different customer message**:
+
----
Customer message: "Hey, just wondering if you have any plans to add dark mode to the mobile app? Would be really nice to have. Thanks!"
----
+
**What they'll see**:
+
[source,json]
----
{
  "ticket_type": "feature_request",
  "priority": "low",
  "summary": "Request for dark mode in mobile app",
  "customer_sentiment": "positive",
  "requires_escalation": false
}
----
+
**Business talking point**: "Same schema, completely different scenario. The AI correctly identified this as a low-priority feature request with positive sentiment. ACME's routing system automatically sends this to the product team instead of urgent support queue."

. **Validate JSON compliance** (1 minute):
+
**Point to the formatted JSON in the response panel**
+
**Business talking point**: "The response panel validates JSON formatting automatically. If you see properly formatted JSON, it's valid. ACME's backend teams can trust every response conforms to their API specification."
+
image::module-02-figure-06.png[Verified JSON output displayed in the response panel,width=600,title="Verified JSON Format"]
+
**Optional CLI validation** (if technical audience):
+
[source,bash]
----
# The JSON can be piped directly to backend APIs
curl -X POST https://acme-tickets.example.com/api/tickets \
  -H "Content-Type: application/json" \
  -d '<paste_json_output>'
----
+
**Business talking point**: "This JSON output goes straight into ACME's ticketing API. No parsing, no transformation, no failure."

**Business value summary**:

"What you've seen is how ACME eliminates 20-30% integration failure rate by constraining AI outputs to exact JSON schemas. Their backend systems receive perfectly formatted data every time, removing parsing errors and enabling direct API integration."

**Troubleshooting scenarios to be ready for**:

**Q: "What if the AI generates invalid enum values?"**
→ A: vLLM's guided decoding guarantees only valid enum values are generated. The model literally cannot output values outside the enum list.

**Q: "How does this handle complex nested JSON structures?"**
→ A: JSON Schema supports arbitrarily complex nesting, arrays, nested objects, and all standard JSON types. ACME's schemas can be as complex as needed.

**Q: "What about performance overhead from schema validation?"**
→ A: Schema constraints add minimal overhead (typically <5%). The business value of zero parsing failures far outweighs the small performance cost.

== Part 2 — Choice mode for simple classification (Optional - 60min demo)

=== Know

_Before diving into complex JSON structures, ACME needs simple automated classification for high-volume scenarios like sentiment analysis and category routing._

**Business challenge**: High-volume classification at scale

* ACME receives thousands of customer feedback messages daily requiring sentiment classification
* Manual classification is impossible at this volume
* Simple yes/no or category decisions don't need full JSON complexity
* Classification must be consistent and machine-readable for automated routing

**Business value**:

Choice mode provides the simplest structured output method for category classification, enabling automated routing and aggregation without JSON overhead.

=== Show

**Presenter guidance** (if time permits): Quickly demonstrate Choice mode as a simpler alternative for basic classification use cases.

. **Clear chat and configure Choice mode** (1 minute):
+
* Click *Clear* in chat interface
* In Structured Outputs panel, select *Choice* mode
* Enter choices: `["positive", "negative", "neutral"]`
+
image::module-02-figure-01.png[Structured outputs configuration panel with Choice mode,width=600,title="Choice Mode Configuration"]

. **Set sentiment analysis prompt** (30 seconds):
+
----
You are a sentiment classifier. Analyze the customer feedback and respond with exactly one word: positive, negative, or neutral. No other output.
----

. **Test with customer feedback** (1-2 minutes):
+
**Test positive**:
+
----
Feedback: "I absolutely love your product! It exceeded all my expectations and the customer service was fantastic."
----
+
Expected: `positive`
+
image::module-02-figure-02.png[Chat interface showing sentiment analysis with Choice mode outputting positive,width=600,title="Sentiment Analysis with Choice"]
+
**Test negative**:
+
----
Feedback: "Terrible experience. The product arrived broken and nobody responded to my support ticket for a week."
----
+
Expected: `negative`
+
**Business talking point**: "Choice mode constrains the model to output ONLY one of the allowed values. ACME uses this for automated routing - negative sentiment goes to priority queues, positive to thank-you workflows."

== Part 3 — Advanced formatting with Regex and Grammar (Optional - 60min demo)

=== Know

_ACME's systems require specific ID formats, phone number formatting, and custom report structures that JSON Schema alone cannot express._

**Use cases for advanced formatting**:

* **Regex patterns**: Enforce exact formats like `ACME-XXXX-1234` ticket IDs, phone numbers, postal codes
* **Grammar rules**: Define complex markup structures for reports and custom formats

**When to use each method**:

[cols="1,1", options="header"]
|===
|Use Case |Best Method

|Simple choices (sentiment, categories)
|Choice mode

|Structured data (APIs, databases)
|JSON Schema

|Specific formats (IDs, codes, phone numbers)
|Regex

|Complex markup, reports, custom structures
|Grammar (GBNF)
|===

=== Show

**Presenter guidance** (only if doing 60min deep dive): Briefly show Regex for ID generation as an example of format enforcement.

. **Configure Regex for ticket ID format** (2 minutes):
+
* Clear chat interface
* Select *Regex* mode in Structured Outputs
* Enter pattern: `ACME-[A-Z]{4}-[0-9]{4}`
+
image::module-02-figure-07.png[Regex pattern configuration in structured outputs panel,width=600,title="Regex Mode"]

. **Test ID generation** (1 minute):
+
**Set prompt**: "Generate a unique ticket ID for the customer support system. Output only the ticket ID, nothing else."
+
**Send**: "Generate a ticket ID for a new billing inquiry."
+
**Expected output**: `ACME-WXYZ-1234` (exact letters/numbers vary but format is guaranteed)
+
image::module-02-figure-08.png[Regex output showing ACME ticket ID format,width=600,title="Regex Constrained Output"]
+
**Business talking point**: "Regex guarantees ACME's ticket IDs match the exact format their tracking system expects. The AI literally cannot generate IDs in any other format."

. **Optional: Show Grammar for reports** (2-3 minutes if time):
+
* Select *Grammar* mode
* Show GBNF grammar for structured reports
* Demonstrate report generation with enforced structure

**Business value summary for advanced formatting**:

"Regex and Grammar provide the final pieces of ACME's structured output toolkit. Whether it's enforcing ID formats, phone number standards, or custom report structures, vLLM Playground ensures AI outputs always match system requirements."

== Demonstration outcomes

By seeing this demonstration, audiences should understand:

* ✓ How JSON Schema eliminates 20-30% integration failure rates with guaranteed schema compliance
* ✓ The business impact of zero-parsing backend integration
* ✓ When to use Choice mode vs JSON Schema vs Regex vs Grammar
* ✓ How enum constraints guarantee only valid categories, priorities, and statuses
* ✓ Real-world application to customer support ticket extraction and routing

== Module summary

**What ACME accomplished**:

* Configured JSON Schema for customer support ticket extraction matching their API specification
* Eliminated integration failures through guaranteed schema compliance
* Demonstrated automated sentiment classification with Choice mode
* (Optional) Showed Regex patterns for ticket ID formatting

**Key takeaways for technical audiences**:

* Structured outputs transform unpredictable AI text into reliable, system-ready data
* JSON Schema is ideal for API integration and database storage - eliminates parsing code
* Choice mode excels for simple category classification at scale
* Regex enforces specific ID and code formats
* Choose the simplest constraint method that meets requirements

**Business value delivered**:

* **Zero integration failures**: 100% schema-compliant JSON eliminates API rejections
* **60-80% faster integrations**: No custom parsing code development needed
* **Automated routing**: Sentiment and priority extracted automatically for queue assignment
* **Data quality improvement**: Required fields and type safety guarantee clean analytics

**Next module preview**:

Module 3 explores *Tool Calling* - enabling ACME's AI to execute functions, retrieve customer data from CRM systems, search knowledge bases, and perform actions on behalf of support agents. This transforms the AI from a text generator into an intelligent assistant with real capabilities.
